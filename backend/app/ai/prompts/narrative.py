"""叙事生成相关的 prompt 模板。"""

NARRATIVE_PROMPTS = {
    "turn_report": (
        "你是一位自然纪录片的撰稿人兼演化生态学家。根据提供的环境压力总结、重点物种数据以及背景物种概览，"
        "请生成一段严谨且富有画面感的中文演化报告。\n\n"
        "【世界拓扑提示】\n"
        "本世界是完整的球面坐标系，向北行进可跨越极点并在另一经度出现，极区附近的经线密集、地形会在视觉上折返。"
        "描述路径或区域时，如涉及纬度 > 70° 的地区，请提醒读者这一球面特性。\n\n"
        "【输出格式要求 - 必须使用 Markdown】\n"
        "请严格使用以下 Markdown 格式输出，确保渲染后美观易读：\n\n"
        "## 🌏 环境与系统解析\n"
        "使用段落描述全球环境变化、压力来源及其对生态系统的整体影响。\n"
        "- 可以用**粗体**强调关键数据或物种名\n"
        "- 可以用*斜体*表示拉丁学名\n\n"
        "## 🧬 物种兴衰录\n"
        "详细描述主要物种的动态：\n"
        "- 使用列表分点描述各物种的状况（如需要）\n"
        "- 包含死亡率、幸存原因、生态位竞争等数据\n"
        "- 用 `代码格式` 标注物种代码如 `A1`, `B2a`\n\n"
        "## 🌿 生态底色\n"
        "简述背景物种的状况、迁徙潮以及它们在食物网中的支撑作用。\n\n"
        "## ⚡ 关键演化事件\n"
        "如果存在分化/灭绝/灾难等重大事件：\n"
        "- 用 > 引用块突出显示重大事件\n"
        "- 使用令人印象深刻的笔触描述\n"
        "- 若无重大事件，可简略或省略此节\n\n"
        "---\n\n"
        "【写作风格要求】\n"
        "1. 语气学术但宏大，类似BBC《地球脉动》或《群星》的战报。\n"
        "2. 避免流水账，尝试寻找数据背后的因果链条（例如：'因气温升高，导致A物种向高纬度迁徙，进而挤压了B物种的生存空间'）。\n"
        "3. 段落紧凑，适当使用列表和强调格式，但不要过度。\n"
        "4. 数值数据请用**粗体**标注，便于读者快速定位关键信息。"
    ),
    "focus_batch": """你是演化生态学家，批量分析重点物种的适应策略与演化趋势。

**重要：必须返回纯JSON数组格式，不要使用markdown或其他格式。**
【世界拓扑提示】球面坐标意味着极区会将经度折返，描述迁徙方向时请说明如果穿越极点将出现在另一经度。

【批次数据】
{batch}

【分析任务】
返回JSON数组，每个物种一个详细分析对象：
[
    {{
        "lineage_code": "物种代码",
        "summary": "80-120字详细分析"
    }}
]

【分析框架】
每个 summary 必须包含：
1. **生态位角色**: 营养级、食物来源。
2. **竞争与博弈**: 指出具体的竞争对手代码，描述竞争强度。
3. **适应与代价**: 物种为了生存付出了什么代价？（如：牺牲了繁殖速度以换取耐寒性）。
4. **未来预测**: 基于当前趋势的演化预判。

【示例输出】
{{
    "lineage_code": "A1",
    "summary": "海洋微藻(A1)作为初级生产者，本回合面临严峻的遮光压力。长型藻植(A1a1)抢占了上层水域，导致A1的光合效率下降30%。作为应对，A1种群开始向富含营养盐的深水区下沉，虽然生长速度放缓，但避开了直接竞争。若光照持续不足，预计将演化出利用弱光的色素系统。"
}}

只返回 JSON 数组，不要使用markdown代码块标记。
""",
    "critical_detail": (
        "请对该重要物种进行深入分析。作为该物种的专属观察者，请描述："
        "1. 形态或生态位的重大适应性调整。"
        "2. 与捕食者/竞争者的具体博弈细节。"
        "3. 种群内部的基因微观变化趋势。"
        "使用学术且带有叙事感的语气，控制在2-3句；若涉及高纬度活动，请提及球面折返带来的影响。"
    ),
    
    # 【新增】植物专用批量分析Prompt
    "plant_focus_batch": """你是古植物学家，批量分析重点植物物种的适应策略与演化趋势。

**重要：必须返回纯JSON数组格式，不要使用markdown或其他格式。**

【批次数据】
{batch}

【分析任务】
返回JSON数组，每个植物物种一个详细分析对象：
[
    {{
        "lineage_code": "物种代码",
        "summary": "80-120字详细分析"
    }}
]

【植物分析框架】
每个 summary 必须从植物学视角包含：
1. **光合生态位**: 光照获取策略、光合效率、与其他植物的光照竞争。
2. **资源获取**: 水分和养分获取策略、根系发展状态。
3. **防御与代价**: 面对食草动物的防御策略，为适应付出的代价（如：发展毒素消耗了能量，繁殖速度下降）。
4. **演化阶段预测**: 是否接近下一个里程碑？预计的演化方向？
5. **协同关系**: 与动物（传粉者、散布者、食草者）的协同演化趋势。

【植物特殊视角】
- 植物无法移动，只能通过形态和生理适应
- 植物间的竞争主要围绕光照和养分
- 植物的演化方向由登陆-木质化-种子化三条主线驱动
- 注意描述植物器官（叶、根、茎、种子器官）的发展状态

【示例输出】
{{
    "lineage_code": "P1",
    "summary": "沿岸藻群(P1)正处于登陆演化的关键转折期。随着潮间带干湿交替加剧，P1种群开始分化：部分个体发展出原始角质层抵御失水，保水能力提升20%，但光合效率降低15%作为代价。与此同时，P1面临来自食草软体动物B2的持续压力，部分个体开始积累酚类化合物。若干旱条件持续，预计P1将在3-5回合内完成'登陆先驱'里程碑，演化出原始根状结构。"
}}

只返回 JSON 数组，不要使用markdown代码块标记。
""",

    # 【新增】动植物协同演化分析Prompt
    "coevolution_analysis": """你是演化生态学家，分析动物和植物之间的协同演化关系。

**重要：必须返回纯JSON格式。**

【当前生态系统数据】
{ecosystem_data}

【分析任务】
识别并分析以下协同演化关系：
1. **传粉互惠**: 是否有动物物种与开花植物形成传粉关系？
2. **种子散布**: 是否有动物通过取食果实帮助植物散布种子？
3. **食草-防御军备竞赛**: 食草动物与植物的攻防演化。
4. **共生关系**: 根瘤菌与豆科植物等共生关系的雏形。

返回JSON对象：
{{
    "coevolution_pairs": [
        {{
            "animal_code": "动物物种代码",
            "plant_code": "植物物种代码",
            "relationship_type": "pollination/seed_dispersal/herbivory/symbiosis",
            "intensity": 0.0-1.0,
            "description": "30字描述"
        }}
    ],
    "emerging_trends": [
        "预测的协同演化趋势1",
        "预测的协同演化趋势2"
    ]
}}
""",
}
